
{% extends "admin_base.html" %}
{% load static %}
{% block content %}
{% include "modal.html" %}
<div class="content">
    {% include "alert.html" %}
        <div class="row">
          <div class="col-md-12">
            <div class="card">
              <div class="card-header">
                <h4 class="card-title">Transactions</h4>
              </div>
              <div class="card-body">
                  <table class="table table-striped table-bordered" id="transaction-table">
                    <thead class="text-primary">
                      <th>#</th>
                      <th>Order ID</th>
                      <th>Customer Name</th>
                      <th>Paid</th>
                      <th class="no-sort">Items</th>
                      <th>Payment Method</th>
                      <th>Date Ordered</th>
                      <th>Delivery Date</th>
                      <th>Delivered Date</th>
                    </thead>
                    <tbody>
                    {% for transaction in transactions %}
                      <tr>
                        <td>{{ forloop.counter }}</td>
                        <td id="trans_id{(transaction.id}}">
                          {{ transaction.final_order.trans_id }}
                        </td>
                        <td>
                        {% for customer_info in customer_infos %}
                            {% if customer_info.final_order == transaction.final_order %}
                                {{ customer_info.first_name }} {% if customer_info.middle_initial %}{{ customer_info.middle_initial }}.{% endif %} {{ customer_info.last_name }}
                            {% endif %}
                        {% endfor %}
                        </td>
                        <td id="paid{{transaction.id}}" class="text-center">
                          {% if transaction.paid %}
                            <i class="fas fa-check"></i>
                          {% endif %}
                        </td>
                        <td id="items{{transaction.id}}" class="text-center">
                            <button class="action btn btn-primary btn-sm" data-id="{% url 'admin_final_order_detail' transaction.final_order.pk %}"><i class="fas fa-eye"></i></button>
                        </td>
                        <td>
                        {% for customer_info in customer_infos %}
                            {% if customer_info.final_order == transaction.final_order %}
                                {% if customer_info.payment_method == 1 %}
                                COD
                                {% else %}
                                PayPal
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                        </td>
                        <td id="date_ordered{{transaction.id}}">
                          {% for customer_info in customer_infos %}
                            {% if customer_info.final_order == transaction.final_order %}
                                {{ customer_info.date_ordered }}
                            {% endif %}
                          {% endfor %}
                        </td>
                        <td id="delivery_date{{transaction.id}}">
                          {{ transaction.delivery_date }}
                        </td>
                        <td id="delivered_date{{transaction.id}}" {% if delivered_date %}class="table primary"{% endif %}>
                          {{ transaction.delivered_date }}
                        </td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
              </div>
            </div>
          </div>
        </div>
      </div>
      <script src="{% static '/assets/dataTables/js/jquery.dataTables.min.js' %}"></script>
      <link href="{% static '/assets/dataTables/css/dataTables.material.min.css' %}" rel="stylesheet">
      <link href="{% static '/assets/dataTables/css/material.min.css' %}" rel="stylesheet">
      <script>
      $(document).ready(function(){
            $('#transaction-table').DataTable( {
              "search": {
                "search": '{{search}}'
              },
              "columnDefs": [ {
                "targets"  : 'no-sort',
                "orderable": false,
                    }],
                  language: {
                      searchPlaceholder: "Search",
                      search: "",
                  }
                  });
      });
      </script>
      <script>
      $(".action").each(function () {
        $(this).modalForm({formURL: $(this).data('id')});
      });
      </script>

{% endblock content %}